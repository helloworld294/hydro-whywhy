(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-150ac3d1"],{"0980":function(e,t,i){},"3c60":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"section-title"},[e._v(e._s(e.$t("m.Avatar_Setting")))]),t("div",{staticClass:"section-main"},[t("avatar",{staticStyle:{"margin-bottom":"15px"},attrs:{username:e.formProfile.username,inline:!0,size:130,color:"#FFF",src:e.avatar}}),e.avatarOption.imgSrc?[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:24,md:12}},[t("div",{staticClass:"cropper-main inline"},[t("vueCropper",{ref:"cropper",attrs:{autoCrop:"",fixed:"",autoCropWidth:200,autoCropHeight:200,img:e.avatarOption.imgSrc,outputSize:e.avatarOption.size,outputType:e.avatarOption.outputType,info:!0},on:{realTime:e.realTime}})],1),t("div",{staticClass:"cropper-btn"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"向左旋转90°",trigger:"hover",placement:"bottom"}},[t("el-button",{attrs:{icon:"el-icon-refresh-left",size:"mini"},on:{click:function(t){return e.rotate("left")}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"向右旋转90°",trigger:"hover",placement:"bottom"}},[t("el-button",{attrs:{icon:"el-icon-refresh-right",size:"mini"},on:{click:function(t){return e.rotate("right")}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"关闭图像截取",trigger:"hover",placement:"bottom"}},[t("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.reselect}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",trigger:"hover",content:"确定图像截取",placement:"bottom"}},[t("el-button",{attrs:{icon:"el-icon-check",size:"mini"},on:{click:e.finishCrop}})],1)],1)]),t("el-col",{attrs:{xs:24,md:12}},[t("div",{staticClass:"cropper-preview",style:e.previewStyle},[t("div",{style:e.preview.div},[t("img",{style:e.preview.img,attrs:{src:e.avatarOption.imgSrc}})])])])],1)]:[t("el-upload",{staticClass:"upload-container",attrs:{action:"",drag:"","before-upload":e.handleSelectFile,disabled:e.isProfileEditForbidden}},[t("div",{staticStyle:{padding:"20px 0"}},[t("i",{staticClass:"el-icon-upload",style:{color:e.isProfileEditForbidden?"#ccc":"#3399ff",fontSize:"52px"}}),t("p",{style:{color:e.isProfileEditForbidden?"#999":"#333"}},[e._v(e._s(e.$t("m.Upload_avatar_hint")))]),e.isProfileEditForbidden?t("p",{staticStyle:{color:"#f56c6c","margin-top":"10px"}},[e._v(e._s(e.$t("m.Forbidden_Modify_Profile")))]):e._e()])])],t("el-dialog",{attrs:{visible:e.uploadModalVisible,title:e.$t("m.Upload"),width:"350px"},on:{"update:visible":function(t){e.uploadModalVisible=t}}},[t("div",{staticClass:"upload-modal"},[t("p",{staticClass:"notice"},[e._v(e._s(e.$t("m.Your_new_avatar")+":"))]),t("img",{attrs:{src:e.uploadImgSrc}})]),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.loadingUploadBtn,type:"primary"},on:{click:e.uploadAvatar}},[e._v(e._s(e.$t("m.Upload")))])],1)])],2),t("div",{staticClass:"section-title"},[e._v(e._s(e.$t("m.UserInfo_Setting")))]),t("el-form",{ref:"formProfile",attrs:{model:e.formProfile}},[t("el-row",{attrs:{gutter:30,justify:"space-around"}},[t("el-col",{attrs:{md:10,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.RealName")}},[t("el-input",{attrs:{maxlength:50},model:{value:e.formProfile.realname,callback:function(t){e.$set(e.formProfile,"realname",t)},expression:"formProfile.realname"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Nickname")}},[t("el-input",{attrs:{maxlength:20},model:{value:e.formProfile.nickname,callback:function(t){e.$set(e.formProfile,"nickname",t)},expression:"formProfile.nickname"}})],1),t("el-form-item",{attrs:{label:e.$t("m.School")}},[t("el-input",{attrs:{maxlength:50},model:{value:e.formProfile.school,callback:function(t){e.$set(e.formProfile,"school",t)},expression:"formProfile.school"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Student_Number")}},[t("el-input",{attrs:{maxlength:20},model:{value:e.formProfile.number,callback:function(t){e.$set(e.formProfile,"number",t)},expression:"formProfile.number"}})],1)],1),t("el-col",{attrs:{md:4,lg:4}},[t("div",{staticClass:"separator hidden-md-and-down"}),t("p")]),t("el-col",{attrs:{md:10,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.CF_Username")}},[t("el-input",{attrs:{maxlength:50},model:{value:e.formProfile.cfUsername,callback:function(t){e.$set(e.formProfile,"cfUsername",t)},expression:"formProfile.cfUsername"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Blog")}},[t("el-input",{attrs:{maxlength:255},model:{value:e.formProfile.blog,callback:function(t){e.$set(e.formProfile,"blog",t)},expression:"formProfile.blog"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Github")}},[t("el-input",{attrs:{maxlength:255},model:{value:e.formProfile.github,callback:function(t){e.$set(e.formProfile,"github",t)},expression:"formProfile.github"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Gender")}},[t("el-radio-group",{model:{value:e.formProfile.gender,callback:function(t){e.$set(e.formProfile,"gender",t)},expression:"formProfile.gender"}},[t("el-radio",{attrs:{label:"male",border:"",size:"small"}},[e._v(e._s(e.$t("m.Male")))]),t("el-radio",{attrs:{label:"female",border:"",size:"small"}},[e._v(e._s(e.$t("m.Female")))]),t("el-radio",{attrs:{label:"secrecy",border:"",size:"small"}},[e._v(e._s(e.$t("m.Secrecy")))])],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("label",{staticClass:"el-form-item__label",staticStyle:{float:"none"}},[e._v(e._s(e.$t("m.Signature")))]),t("Editor",{staticStyle:{padding:"5px"},attrs:{value:e.formProfile.signature},on:{"update:value":function(t){return e.$set(e.formProfile,"signature",t)}}})],1)],1)],1),t("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[e.canModifyProfile?e._e():t("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:e.$t("m.Profile_Edit_Forbidden"),type:"warning",closable:!1}}),t("el-button",{attrs:{type:"primary",loading:e.loadingSaveBtn,disabled:!e.canModifyProfile},on:{click:e.updateUserInfo}},[e._v(e._s(e.$t("m.Save")))])],1)],1)},a=[],o=(i("e9f5"),i("7d54"),i("3228")),l=i("90b9"),s=i("7aa9"),n=i("7e79"),c=i("4a89"),m=i.n(c);i("e05f");const d=()=>Promise.resolve().then(i.bind(null,"a956"));var f={components:{Avatar:m.a,VueCropper:n["VueCropper"],Editor:d},data(){return{loadingSaveBtn:!1,loadingUploadBtn:!1,uploadModalVisible:!1,preview:{},uploadImgSrc:"",avatarOption:{imgSrc:"",size:.8,outputType:"png"},formProfile:{realname:"",username:"",cfUsername:"",gender:"",nickname:"",signature:"",number:"",blog:"",school:"",github:""}}},mounted(){let e=this.$store.getters.userInfo;Object.keys(this.formProfile).forEach(t=>{void 0!==e[t]&&(this.formProfile[t]=e[t])})},methods:{checkFileType(e){return!!/\.(gif|jpg|jpeg|png|bmp|webp|GIF|JPG|PNG|WEBP)$/.test(e.name)||(this.$notify.warning({title:this.$i18n.t("m.File_type_not_support"),message:e.name+this.$i18n.t("m.is_incorrect_format_file")}),!1)},checkFileSize(e){return!(e.size>2097152)||(this.$notify.warning({title:this.$i18n.t("m.Exceed_max_size_limit"),message:e.name+this.$i18n.t("m.File_Exceed_Tips")}),!1)},handleSelectFile(e){if(this.isProfileEditForbidden)return s["a"].error(this.$i18n.t("m.Forbidden_Modify_Profile")),!1;let t=this.checkFileType(e)&&this.checkFileSize(e);if(!t)return!1;let i=new window.FileReader;return i.onload=e=>{this.avatarOption.imgSrc=e.target.result},i.readAsDataURL(e),!1},realTime(e){this.preview=e},rotate(e){"left"===e?this.$refs.cropper.rotateLeft():this.$refs.cropper.rotateRight()},reselect(){this.$confirm(this.$i18n.t("m.Cancel_Avater_Tips"),"Tips",{confirmButtonText:this.$i18n.t("m.OK"),cancelButtonText:this.$i18n.t("m.Cancel"),type:"warning"}).then(()=>{this.avatarOption.imgSrc=""})},finishCrop(){this.$refs.cropper.getCropData(e=>{this.uploadImgSrc=e,this.uploadModalVisible=!0})},uploadAvatar(){this.isProfileEditForbidden?s["a"].error(this.$i18n.t("m.Forbidden_Modify_Profile")):this.$refs.cropper.getCropBlob(e=>{let t=new window.FormData,i=new window.File([e],"avatar."+this.avatarOption.outputType);t.append("image",i),this.loadingUploadBtn=!0,this.$http({method:"post",url:"/api/file/upload-avatar",data:t,headers:{"content-type":"multipart/form-data"}}).then(e=>{this.loadingUploadBtn=!1,s["a"].success(this.$i18n.t("m.Upload_Avatar_Successfully")),this.uploadModalVisible=!1,this.avatarOption.imgSrc="",this.$store.dispatch("setUserInfo",e.data.data)},e=>{this.loadingUploadBtn=!1,e.data&&e.data.msg&&s["a"].error(e.data.msg)})})},updateUserInfo(){if(!this.canModifyProfile)return void s["a"].error(this.$i18n.t("m.Profile_Edit_Forbidden"));this.loadingSaveBtn=!0;let e=l["a"].filterEmptyValue(Object.assign({},this.formProfile));e.gender||(e.gender="secrecy"),o["a"].changeUserInfo(e).then(e=>{s["a"].success(this.$i18n.t("m.Update_Successfully")),this.$store.dispatch("setUserInfo",e.data.data),this.loadingSaveBtn=!1},e=>{this.loadingSaveBtn=!1})}},computed:{avatar(){return this.$store.getters.userInfo.avatar},previewStyle(){return{width:this.preview.w+"px",height:this.preview.h+"px",overflow:"hidden"}},canModifyProfile(){return!0},isProfileEditForbidden(){const e=this.$store.getters.userInfo;return!(!e||!e.roleList)&&(e.roleList.includes("no_profile_edit_user")||e.roleList.includes("no_profile_edit_mute_user"))}}},p=f,u=(i("45f4"),i("2877")),h=Object(u["a"])(p,r,a,!1,null,"a3f32dae",null);t["default"]=h.exports},"45f4":function(e,t,i){"use strict";i("0980")}}]);