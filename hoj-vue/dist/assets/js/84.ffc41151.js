"use strict";(self["webpackChunkhoj_vue"]=self["webpackChunkhoj_vue"]||[]).push([[84],{33747:function(t,e,s){s(52093);var a=s(27328),n=s(50651),o=s(97889),r=s(83853);e.A={methods:{initConcernedList(){let t=(0,o.xJ)(this.$route.params.contestID);this.concernedList=r.A.get(t)||[]},getContestRankData(t=1,e=!1){this.showChart&&!e&&this.$refs.chart.showLoading({maskColor:"rgba(250, 250, 250, 0.8)"});let s={currentPage:t,limit:this.limit,cid:this.$route.params.contestID,forceRefresh:!!this.forceUpdate,removeStar:!this.showStarUser,concernedList:this.concernedList,keyword:null==this.keyword?null:this.keyword.trim(),containsEnd:"after"===this.rankType};a.A.getContestRank(s).then(s=>{this.showChart&&!e&&this.$refs.chart.hideLoading(),this.total=s.data.data.total,1===t&&this.applyToChart(s.data.data.records),this.applyToTable(s.data.data.records)})},handleAutoRefresh(t){1==t?this.refreshFunc=setInterval(()=>{this.$store.dispatch("getContestProblems"),this.getContestRankData(this.page,!0)},1e4):clearInterval(this.refreshFunc)},updateConcernedList(t,e){if(e)this.concernedList.push(t);else{var s=this.concernedList.indexOf(t);s>-1&&this.concernedList.splice(s,1)}let a=(0,o.xJ)(this.contestID);r.A.set(a,this.concernedList),this.getContestRankData(this.page,!0)},getRankShowName(t,e){let s=t;return null!=t&&""!=t&&0!=t.trim().length||(s=e),s}},computed:{...(0,n.L8)(["isContestAdmin","userInfo","isContainsAfterContestJudge"]),...(0,n.aH)({contest:t=>t.contest.contest,contestProblems:t=>t.contest.contestProblems}),showChart:{get(){return this.$store.state.contest.itemVisible.chart},set(t){this.$store.commit("changeContestItemVisible",{chart:t})}},showStarUser:{get(){return!this.$store.state.contest.removeStar},set(t){this.$store.commit("changeRankRemoveStar",{value:!t})}},showTable:{get(){return this.$store.state.contest.itemVisible.table},set(t){this.$store.commit("changeContestItemVisible",{table:t})}},forceUpdate:{get(){return this.$store.state.contest.forceUpdate},set(t){this.$store.commit("changeRankForceUpdate",{value:t})}},concernedList:{get(){return this.$store.state.contest.concernedList},set(t){this.$store.commit("changeConcernedList",{value:t})}},refreshDisabled(){return this.contest.status==o.kI.ENDED}},beforeDestroy(){clearInterval(this.refreshFunc)}}},47084:function(t,e,s){s.r(e),s.d(e,{default:function(){return y}});var a=function(){var t=this,e=t._self._c;return e("el-card",{attrs:{shadow:""}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("span",{staticClass:"panel-title"},[t._v(t._s(t.$t("m.Contest_Rank")))]),t.contest.allowEndSubmit?e("div",{staticStyle:{display:"flex","align-items":"center",gap:"10px"}},[e("el-radio-group",{attrs:{size:"small"},on:{change:t.onRankTypeChange},model:{value:t.rankType,callback:function(e){t.rankType=e},expression:"rankType"}},[e("el-radio-button",{attrs:{label:"contest"}},[t._v(t._s(t.$t("m.Contest_Rank")))]),e("el-radio-button",{attrs:{label:"after"}},[t._v(t._s(t.$t("m.Contest_After_Rank")))])],1)],1):t._e()])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showChart,expression:"showChart"}],staticClass:"echarts"},[e("ECharts",{ref:"chart",attrs:{options:t.options,autoresize:!0}})],1),e("el-row",[e("el-col",{attrs:{xs:24,md:8}},[e("div",{staticClass:"contest-rank-search contest-rank-filter"},[e("el-input",{attrs:{placeholder:t.$t("m.Contest_Rank_Search_Placeholder")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getContestRankData(t.page)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[e("el-button",{staticClass:"search-btn",attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return t.getContestRankData(t.page)}},slot:"append"})],1)],1)]),e("el-col",{attrs:{xs:24,md:16}},[e("div",{staticClass:"contest-rank-config"},[e("el-popover",{attrs:{trigger:"hover",placement:"left-start"}},[e("el-button",{attrs:{slot:"reference",round:"",size:"small"},slot:"reference"},[t._v(" "+t._s(t.$t("m.Contest_Rank_Setting"))+" ")]),e("div",{attrs:{id:"switches"}},[e("p",[e("span",[t._v(t._s(t.$t("m.Chart")))]),e("el-switch",{model:{value:t.showChart,callback:function(e){t.showChart=e},expression:"showChart"}})],1),e("p",[e("span",[t._v(t._s(t.$t("m.Table")))]),e("el-switch",{model:{value:t.showTable,callback:function(e){t.showTable=e},expression:"showTable"}})],1),e("p",[e("span",[t._v(t._s(t.$t("m.Star_User")))]),e("el-switch",{on:{change:function(e){return t.getContestRankData(t.page)}},model:{value:t.showStarUser,callback:function(e){t.showStarUser=e},expression:"showStarUser"}})],1),e("p",[e("span",[t._v(t._s(t.$t("m.Auto_Refresh"))+"(10s)")]),e("el-switch",{attrs:{disabled:t.refreshDisabled},on:{change:t.handleAutoRefresh},model:{value:t.autoRefresh,callback:function(e){t.autoRefresh=e},expression:"autoRefresh"}})],1),t.isContestAdmin?[e("p",[e("span",[t._v(t._s(t.$t("m.Force_Update")))]),e("el-switch",{on:{change:function(e){return t.getContestRankData(t.page)}},model:{value:t.forceUpdate,callback:function(e){t.forceUpdate=e},expression:"forceUpdate"}})],1)]:t._e(),t.isContestAdmin?[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.downloadRankCSV}},[t._v(t._s(t.$t("m.Download_as_CSV")))])]:t._e()],2)],1)],1)])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}]},[e("vxe-table",{ref:"ACMContestRank",attrs:{round:"",border:"","auto-resize":"",size:"medium",align:"center",data:t.dataRank,"cell-class-name":t.cellClassName},on:{"cell-click":t.getUserProblemSubmission}},[e("vxe-table-column",{attrs:{field:"rank",width:"50",fixed:"left",title:t.$t("m.Contest_Rank_Seq")},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[-1==s.rank?[e("span",[t._v("*")])]:[s.isWinAward?[e("RankBox",{attrs:{num:s.rank,background:s.awardBackground,color:s.awardColor,name:s.awardName}})]:[e("RankBox",{attrs:{num:s.rank}})]]]}}])}),t.isMobileView?e("vxe-table-column",{attrs:{field:"username","min-width":"300",title:t.$t("m.User"),"header-align":"center",align:"left"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"contest-rank-user-box"},[e("span",[e("avatar",{attrs:{username:s.rankShowName,inline:!0,size:37,color:"#FFF",src:s.avatar,title:s.rankShowName}})],1),e("el-tooltip",{attrs:{placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(s.isConcerned?t.$t("m.Unfollow"):t.$t("m.Top_And_Follow"))+" ")]),e("span",{staticClass:"contest-rank-concerned",on:{click:function(e){return t.updateConcernedList(s.uid,!s.isConcerned)}}},[s.isConcerned?e("i",{staticClass:"fa fa-star",staticStyle:{color:"red"}}):e("i",{staticClass:"el-icon-star-off"})])]),e("span",{staticClass:"contest-rank-user-info"},[e("a",{on:{click:function(e){return t.getUserHomeByUsername(s.uid,s.username)}}},[e("span",{staticClass:"contest-username",attrs:{title:s.rankShowName}},[s.uid==t.userInfo.uid?e("span",{staticClass:"contest-rank-flag"},[t._v("Own")]):t._e(),-1==s.rank?e("span",{staticClass:"contest-rank-flag"},[t._v("Star")]):t._e(),"female"==s.gender?e("span",{staticClass:"contest-rank-flag"},[t._v("Girl")]):t._e(),t._v(" "+t._s(s.rankShowName))]),s.school?e("span",{staticClass:"contest-school",attrs:{title:s.school}},[t._v(t._s(s.school))]):t._e()])])],1)]}}])}):e("vxe-table-column",{attrs:{field:"username",fixed:"left","min-width":"300",title:t.$t("m.User"),"header-align":"center",align:"left"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"contest-rank-user-box"},[e("span",[e("avatar",{attrs:{username:s.rankShowName,inline:!0,size:37,color:"#FFF",src:s.avatar,title:s.rankShowName}})],1),e("el-tooltip",{attrs:{placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(s.isConcerned?t.$t("m.Unfollow"):t.$t("m.Top_And_Follow"))+" ")]),e("span",{staticClass:"contest-rank-concerned",on:{click:function(e){return t.updateConcernedList(s.uid,!s.isConcerned)}}},[s.isConcerned?e("i",{staticClass:"fa fa-star",staticStyle:{color:"red"}}):e("i",{staticClass:"el-icon-star-off"})])]),e("span",{staticClass:"contest-rank-user-info"},[e("a",{on:{click:function(e){return t.getUserHomeByUsername(s.uid,s.username)}}},[e("span",{staticClass:"contest-username",attrs:{title:s.rankShowName}},[s.uid==t.userInfo.uid?e("span",{staticClass:"contest-rank-flag"},[t._v("Own")]):t._e(),-1==s.rank?e("span",{staticClass:"contest-rank-flag"},[t._v("Star")]):t._e(),"female"==s.gender?e("span",{staticClass:"contest-rank-flag"},[t._v("Girl")]):t._e(),t._v(" "+t._s(s.rankShowName))]),s.school?e("span",{staticClass:"contest-school",attrs:{title:s.school}},[t._v(t._s(s.school))]):t._e()])])],1)]}}],null,!1,3657049288)}),t.isContestAdmin?e("vxe-table-column",{attrs:{field:"realname","min-width":"96",title:t.$t("m.RealName"),"show-overflow":""}}):t._e(),e("vxe-table-column",{attrs:{field:"rating",title:t.$t("m.AC"),"min-width":"60"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("span",[e("a",{staticStyle:{color:"rgb(87, 163, 243)","font-weight":"600","font-size":"14px"},on:{click:function(e){return t.getUserACSubmit(s.username)}}},[t._v(t._s(s.ac)+" ")])])]}}])}),e("vxe-table-column",{attrs:{field:"totalTime",title:t.$t("m.TotalTime"),"min-width":"60"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(t.parseTimeToSpecific(s.totalTime))+" ")]),e("span",[t._v(t._s(parseInt(s.totalTime/60)))])])]}}])}),t._l(t.contestProblems,function(s){return e("vxe-table-column",{key:s.displayId,attrs:{"min-width":"74",field:s.displayId},scopedSlots:t._u([{key:"header",fn:function(){return[s.color?e("span",{staticClass:"contest-rank-balloon"},[e("svg",{staticClass:"icon",attrs:{t:"1633685184463",viewBox:"0 0 1088 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5840",width:"25",height:"25"}},[e("path",{attrs:{d:"M575.872 849.408c-104.576 0-117.632-26.56-119.232-31.808-6.528-22.528 32.896-70.592 63.744-96.768l-1.728-2.624c137.6-42.688 243.648-290.112 243.648-433.472A284.544 284.544 0 0 0 478.016 0a284.544 284.544 0 0 0-284.288 284.736c0 150.4 116.352 415.104 263.744 438.336-25.152 29.568-50.368 70.784-39.104 108.928 12.608 43.136 62.72 63.232 157.632 63.232 7.872 0 11.52 9.408 4.352 19.52-21.248 29.248-77.888 63.424-167.68 63.424V1024c138.944 0 215.936-74.816 215.936-126.528a46.72 46.72 0 0 0-16.32-36.608 56.32 56.32 0 0 0-36.416-11.456zM297.152 297.472c0 44.032-38.144 25.344-38.144-38.656 0-108.032 85.248-195.712 190.592-195.712 62.592 0 81.216 39.232 38.08 39.232-105.152 0.064-190.528 87.04-190.528 195.136z",fill:s.color,"p-id":"5841"}})])]):t._e(),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-weight":"bold","margin-bottom":"2px"}},[e("a",{staticClass:"emphasis",staticStyle:{color:"#495060","font-size":"12px"},on:{click:function(e){return t.getContestProblemById(s.displayId)}}},[t._v(t._s(s.displayId))])]),e("div",{staticStyle:{"font-size":"10px",color:"#999"}},[e("a",{staticClass:"emphasis",staticStyle:{color:"#999"},on:{click:function(e){return t.getContestProblemById(s.displayId)}}},[t._v(t._s(s.displayTitle||"题目"+s.displayId))])]),e("div",{staticStyle:{"font-size":"9px",color:"#666","margin-top":"2px"}},[e("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(s.displayId+". "+s.displayTitle)+" "),e("br"),t._v(" "+t._s("Accepted: "+s.ac)+" "),e("br"),t._v(" "+t._s("Rejected: "+(s.total-s.ac))+" ")]),e("span",[t._v("("+t._s(s.ac)+"/"+t._s(s.total)+") ")])])],1)])]},proxy:!0},{key:"default",fn:function({row:a}){return[a.submissionInfo[s.displayId]?e("span",{staticClass:"submission-hover"},[e("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(a.submissionInfo[s.displayId].specificTime)+" ")]),a.submissionInfo[s.displayId].isAC?e("span",{staticClass:"submission-time"},[t._v(t._s(a.submissionInfo[s.displayId].isAfterContest?"*":a.submissionInfo[s.displayId].ACTime)),e("br")]):t._e()]),null==a.submissionInfo[s.displayId].tryNum&&0!=a.submissionInfo[s.displayId].errorNum?e("span",{staticClass:"submission-error"},[t._v(" "+t._s(a.submissionInfo[s.displayId].errorNum>1?a.submissionInfo[s.displayId].errorNum+" tries":a.submissionInfo[s.displayId].errorNum+" try")+" ")]):t._e(),null!=a.submissionInfo[s.displayId].tryNum?e("span",[a.submissionInfo[s.displayId].errorNum>0?[t._v(" "+t._s(a.submissionInfo[s.displayId].errorNum)+"+")]:t._e(),t._v(t._s(a.submissionInfo[s.displayId].tryNum)+t._s(a.submissionInfo[s.displayId].errorNum+a.submissionInfo[s.displayId].tryNum>1?" tries":" try")+" ")],2):t._e()],1):t._e()]}}],null,!0)})})],2)],1),e("Pagination",{attrs:{total:t.total,"page-size":t.limit,"page-sizes":[10,30,50,100,300,500],current:t.page,layout:"prev, pager, next, sizes"},on:{"update:pageSize":function(e){t.limit=e},"update:page-size":function(e){t.limit=e},"update:current":function(e){t.page=e},"on-change":t.getContestRankData,"on-page-size-change":function(e){return t.getContestRankData(1)}}})],1)},n=[],o=(s(52093),s(17932),s(19329),s(10670)),r=s.n(o),i=s(98609),l=s.n(i),c=s(50651),d=s(51047),u=s(15637),m=s(33747);const p=()=>Promise.resolve().then(s.bind(s,76902)),h=()=>s.e(146).then(s.bind(s,70146));var f={name:"ACMContestRank",mixins:[m.A],components:{Pagination:p,RankBox:h,Avatar:r()},data(){return{total:0,page:1,limit:50,autoRefresh:!1,contestID:"",dataRank:[],keyword:null,rankType:"contest",options:{title:{text:this.$i18n.t("m.Top_10_Teams"),left:"center",top:0},dataZoom:[{type:"inside",filterMode:"none",xAxisIndex:[0],start:0,end:100}],toolbox:{show:!0,feature:{saveAsImage:{show:!0,title:this.$i18n.t("m.save_as_image")}},right:"0"},tooltip:{trigger:"axis",axisPointer:{type:"cross",axis:"x"}},legend:{orient:"horizontal",x:"center",top:"8%",right:0,data:[],formatter:t=>u.A.breakLongWords(t,16),textStyle:{fontSize:12}},grid:{x:80,x2:100,left:"5%",top:"25%",right:"5%",bottom:"10%"},xAxis:[{type:"time",splitLine:!1,axisPointer:{show:!0,snap:!0}}],yAxis:[{type:"category",boundaryGap:!1,data:[0]}],series:[]}}},created(){this.initConcernedList()},mounted(){this.contestID=this.$route.params.contestID,this.getContestRankData(1),this.addChartCategory(this.contestProblems),this.refreshDisabled||(this.autoRefresh=!0,this.handleAutoRefresh(!0))},methods:{...(0,c.i0)(["getContestProblems"]),getUserACSubmit(t){this.$router.push({name:"ContestSubmissionList",query:{username:t,status:0}})},getUserHomeByUsername(t,e){this.$router.push({name:"UserHome",query:{username:e,uid:t}})},getContestProblemById(t){this.$router.push({name:"ContestProblemDetails",params:{contestID:this.contestID,problemID:t}})},getUserProblemSubmission({row:t,column:e}){"rank"!=e.property&&"rating"!=e.property&&"totalTime"!=e.property&&"username"!=e.property&&"realname"!=e.property&&this.$router.push({name:"ContestSubmissionList",query:{username:t.username,problemID:e.property,completeProblemID:!0}})},cellClassName({row:t,rowIndex:e,column:s,columnIndex:a}){return t.username!=this.userInfo.username||"rank"!=s.property&&"rating"!=s.property&&"totalTime"!=s.property&&"username"!=s.property&&"realname"!=s.property?"username"==s.property&&t.userCellClassName?t.userCellClassName:"rank"!=s.property&&"rating"!=s.property&&"totalTime"!=s.property&&"username"!=s.property&&"realname"!=s.property?this.isContestAdmin?t.cellClassName[[this.contestProblems[a-5].displayId]]:t.cellClassName[[this.contestProblems[a-4].displayId]]:t.isConcerned&&"username"!==s.property?"bg-concerned":void 0:"own-submit-row"},applyToTable(t){t.forEach((t,e)=>{let s=t.submissionInfo,a={};-1!=this.concernedList.indexOf(t.uid)&&(t.isConcerned=!0),Object.keys(s).forEach(e=>{t[e]=s[e],null!=t[e].ACTime&&(t[e].errorNum+=1,t[e].specificTime=this.parseTimeToSpecific(t[e].ACTime),t[e].ACTime=parseInt(t[e].ACTime/60));let n=s[e];n.isAfterContest&&n.isAC?a[e]="after-ac":n.isFirstAC?a[e]="first-ac":n.isAC?a[e]="ac":null!=n.tryNum&&n.tryNum>0?a[e]="try":0!=n.errorNum&&(a[e]="wa")}),t.cellClassName=a,-1==t.rank&&(t.userCellClassName="bg-star"),"female"==t.gender&&(t.userCellClassName="bg-female"),t.rankShowName=this.getRankShowName(t[this.contest.rankShowName],t.username)}),this.dataRank=t},addChartCategory(t){let e=[];for(let s=0;s<=t.length;++s)e.push(s);this.options.yAxis[0].data=e},applyToChart(t){let[e,s]=[[],[]],a=t.length,n=this.concernedList.length||0;t.length>0&&t[0].uid==this.userInfo.uid&&n++;for(let o=n;o<a&&o<n+10;o++){let a=t[o],n=this.getRankShowName(a[this.contest.rankShowName],a.username);e.push(n);let r=a.submissionInfo,i=[];Object.keys(r).forEach(t=>{r[t].isAC&&i.push(r[t].ACTime)}),i.sort((t,e)=>t-e);let c=[];c.push([this.contest.startTime,0]);for(let[t,e]of i.entries()){let s=l()(this.contest.startTime).add(e,"seconds").format();c.push([s,t+1])}s.push({name:n,type:"line",data:c})}this.options.legend.data=e,this.options.series=s},parseTimeToSpecific(t){return d.A.secondFormat(t)},downloadRankCSV(){u.A.downloadFile(`/api/file/download-contest-rank?cid=${this.$route.params.contestID}&forceRefresh=${!!this.forceUpdate}&containEnd=${"after"===this.rankType}`)},onRankTypeChange(){this.getContestRankData(1)}},watch:{contestProblems(t,e){0!=t.length&&this.addChartCategory(this.contestProblems)},isContainsAfterContestJudge(t,e){this.getContestRankData(this.page)}},computed:{contest(){return this.$store.state.contest.contest},isMobileView(){return window.screen.width<768}}},C=f,g=s(37419),k=(0,g.A)(C,a,n,!1,null,"0c8d7e82",null),y=k.exports}}]);