(self["webpackChunkhoj_vue"]=self["webpackChunkhoj_vue"]||[]).push([[980],{1980:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"view"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"panel-title home-title"},[e._v(e._s(e.$t("m.General_User")))]),t("div",{staticClass:"filter-row"},[t("span",[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.openAddUserDialog}},[e._v(e._s(e.$t("m.Add_Single_User"))+" ")])],1),t("span",[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete-solid",size:"small"},on:{click:function(t){return e.deleteUsers(null)}}},[e._v(e._s(e.$t("m.Delete"))+" ")])],1),t("span",[t("vxe-input",{attrs:{placeholder:e.$t("m.Enter_keyword"),type:"search",size:"medium"},on:{"search-click":e.filterByKeyword},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filterByKeyword.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),t("span",[t("el-switch",{attrs:{"active-text":e.$t("m.OnlyAdmin"),width:40,"inactive-text":e.$t("m.All")},on:{change:e.filterByAdmin},model:{value:e.onlyAdmin,callback:function(t){e.onlyAdmin=t},expression:"onlyAdmin"}})],1)])]),t("vxe-table",{ref:"xTable",attrs:{stripe:"","auto-resize":"",data:e.userList,loading:e.loadingTable,"checkbox-config":{labelField:"id",highlight:!0,range:!0,checkMethod:e.checCheckboxkMethod}},on:{"checkbox-change":e.handleSelectionChange,"checkbox-all":e.handlechangeAll}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60"}}),t("vxe-table-column",{attrs:{field:"username",title:e.$t("m.User"),"min-width":"200","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("span",[e._v(e._s(s.username))]),t("span",{staticStyle:{"margin-left":"2px"}},[s.titleName?t("el-tag",{attrs:{effect:"dark",size:"small",color:s.titleColor}},[e._v(" "+e._s(s.titleName)+" ")]):e._e()],1)]}}])}),t("vxe-table-column",{attrs:{field:"realname",title:e.$t("m.RealName"),"min-width":"140","show-overflow":""}}),t("vxe-table-column",{attrs:{field:"email",title:e.$t("m.Email"),"min-width":"150","show-overflow":""}}),t("vxe-table-column",{attrs:{field:"gmtCreate",title:e.$t("m.Created_Time"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e._f("localtime")(t.gmtCreate))+" ")]}}])}),t("vxe-table-column",{attrs:{field:"role",title:e.$t("m.User_Type"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e._f("parseRole")(e.getRole(t.roles)))+" ")]}}])}),t("vxe-table-column",{attrs:{field:"status",title:e.$t("m.Status"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[0==s.status?t("el-tag",{attrs:{effect:"dark",color:"#19be6b"}},[e._v(e._s(e.$t("m.Normal")))]):t("el-tag",{attrs:{effect:"dark",color:"#ed3f14"}},[e._v(e._s(e.$t("m.Disable")))])]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.Option"),"min-width":"200"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("el-tooltip",{attrs:{effect:"dark",content:e.$t("m.Edit_User"),placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-edit-outline",size:"mini",type:"primary"},nativeOn:{click:function(t){return e.openUserDialog(s)}}})],1),s.realname?t("el-tooltip",{attrs:{effect:"dark",content:e.$t("m.Reject_Real_Name"),placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-refresh-left",size:"mini",type:"warning"},nativeOn:{click:function(t){return e.rejectRealName(s)}}})],1):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:e.$t("m.Delete_User"),placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-delete-solid",size:"mini",type:"danger"},nativeOn:{click:function(t){return e.deleteUsers([s.uid])}}})],1)]}}])})],1),t("div",{staticClass:"panel-options"},[t("el-pagination",{staticClass:"page",attrs:{layout:"prev, pager, next, sizes","page-size":e.pageSize,total:e.total,"page-sizes":[10,30,50,100]},on:{"current-change":e.currentChange,"size-change":e.onPageSizeChange}})],1)],1),t("SecurityConfirm",{attrs:{visible:e.securityConfirmVisible,"operation-description":e.securityOperationDescription,"operation-type":e.securityOperationType,"operation-data":e.securityOperationData},on:{confirm:e.handleSecurityConfirm,cancel:e.handleSecurityCancel}}),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"panel-title home-title"},[e._v(e._s(e.$t("m.Import_User")))])]),t("p",[e._v("1. "+e._s(e.$t("m.Import_User_Tips1")))]),t("p",[e._v("2. "+e._s(e.$t("m.Import_User_Tips2")))]),t("p",[e._v("3. "+e._s(e.$t("m.Import_User_Tips3")))]),t("p",[e._v("4. "+e._s(e.$t("m.Import_User_Tips4")))]),t("p",[e._v("5. "+e._s(e.$t("m.Import_User_Tips5")))]),e.uploadUsers.length?[t("vxe-table",{attrs:{data:e.uploadUsersPage,stripe:"","auto-resize":""}},[t("vxe-table-column",{attrs:{title:e.$t("m.Username"),field:"username","min-width":"96","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[0])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.Password"),field:"password","min-width":"130","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[1])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.Email"),field:"email","min-width":"120","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[2])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.RealName"),field:"realname","min-width":"150","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[3])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.Gender"),field:"gender","min-width":"60","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[4])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.Nickname"),field:"nickname","min-width":"100","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[5])+" ")]}}])}),t("vxe-table-column",{attrs:{title:e.$t("m.School"),field:"school","min-width":"100","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[6])+" ")]}}])})],1),t("div",{staticClass:"panel-options"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-upload"},on:{click:e.handleUsersUpload}},[e._v(e._s(e.$t("m.Upload_All"))+" ")]),t("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:e.handleResetData}},[e._v(e._s(e.$t("m.Clear_All"))+" ")]),t("el-pagination",{staticClass:"page",attrs:{layout:"prev, pager, next","page-size":e.uploadUsersPageSize,"current-page":e.uploadUsersCurrentPage,total:e.uploadUsers.length},on:{"update:currentPage":function(t){e.uploadUsersCurrentPage=t},"update:current-page":function(t){e.uploadUsersCurrentPage=t}}})],1)]:t("el-upload",{attrs:{action:"","show-file-list":!1,accept:".csv","before-upload":e.handleUsersCSV}},[t("el-button",{attrs:{size:"small",icon:"el-icon-folder-opened",type:"primary"}},[e._v(e._s(e.$t("m.Choose_File")))])],1)],2),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"panel-title home-title"},[e._v(e._s(e.$t("m.Generate_User")))])]),t("el-form",{ref:"formGenerateUser",attrs:{model:e.formGenerateUser,rules:e.formGenerateRules}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{md:5,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.Prefix"),prop:"prefix"}},[t("el-input",{attrs:{placeholder:"Prefix"},model:{value:e.formGenerateUser.prefix,callback:function(t){e.$set(e.formGenerateUser,"prefix",t)},expression:"formGenerateUser.prefix"}})],1)],1),t("el-col",{attrs:{md:5,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.Suffix"),prop:"suffix"}},[t("el-input",{attrs:{placeholder:"Suffix"},model:{value:e.formGenerateUser.suffix,callback:function(t){e.$set(e.formGenerateUser,"suffix",t)},expression:"formGenerateUser.suffix"}})],1)],1),t("el-col",{attrs:{md:5,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.Start_Number"),prop:"number_from"}},[t("el-input-number",{staticStyle:{width:"100%"},model:{value:e.formGenerateUser.number_from,callback:function(t){e.$set(e.formGenerateUser,"number_from",t)},expression:"formGenerateUser.number_from"}})],1)],1),t("el-col",{attrs:{md:5,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.End_Number"),prop:"number_to"}},[t("el-input-number",{staticStyle:{width:"100%"},model:{value:e.formGenerateUser.number_to,callback:function(t){e.$set(e.formGenerateUser,"number_to",t)},expression:"formGenerateUser.number_to"}})],1)],1),t("el-col",{attrs:{md:4,xs:24}},[t("el-form-item",{attrs:{label:e.$t("m.Password_Length"),prop:"password_length"}},[t("el-input",{attrs:{placeholder:e.$t("m.Password_Length")},model:{value:e.formGenerateUser.password_length,callback:function(t){e.$set(e.formGenerateUser,"password_length",e._n(t))},expression:"formGenerateUser.password_length"}})],1)],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"fa fa-users",loading:e.loadingGenerate,size:"small"},on:{click:e.generateUser}},[e._v(" "+e._s(e.$t("m.Generate_and_Export"))+" ")]),e.formGenerateUser.number_from<=e.formGenerateUser.number_to?t("span",{staticClass:"userPreview"},[e._v(" "+e._s(e.$t("m.The_usernames_will_be"))+" "+e._s(e.formGenerateUser.prefix+e.formGenerateUser.number_from+e.formGenerateUser.suffix)+", "),e.formGenerateUser.number_from+1<e.formGenerateUser.number_to?t("span",[e._v(" "+e._s(e.formGenerateUser.prefix+(e.formGenerateUser.number_from+1)+e.formGenerateUser.suffix+"...")+" ")]):e._e(),e.formGenerateUser.number_from+1<=e.formGenerateUser.number_to?t("span",[e._v(" "+e._s(e.formGenerateUser.prefix+e.formGenerateUser.number_to+e.formGenerateUser.suffix)+" ")]):e._e()]):e._e()],1)],1)],1),t("el-dialog",{attrs:{title:e.$t("m.User"),visible:e.showUserDialog,width:"350px"},on:{"update:visible":function(t){e.showUserDialog=t}}},[t("el-form",{ref:"updateUser",attrs:{model:e.selectUser,"label-width":"100px","label-position":"left",rules:e.updateUserRules}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Username"),required:"",prop:"username"}},[t("el-input",{attrs:{size:"small"},model:{value:e.selectUser.username,callback:function(t){e.$set(e.selectUser,"username",t)},expression:"selectUser.username"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.RealName"),prop:"realname"}},[t("el-input",{attrs:{size:"small"},model:{value:e.selectUser.realname,callback:function(t){e.$set(e.selectUser,"realname",t)},expression:"selectUser.realname"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Email"),prop:"email"}},[t("el-input",{attrs:{size:"small"},model:{value:e.selectUser.email,callback:function(t){e.$set(e.selectUser,"email",t)},expression:"selectUser.email"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Set_New_PWD")}},[t("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},model:{value:e.selectUser.setNewPwd,callback:function(t){e.$set(e.selectUser,"setNewPwd",t)},expression:"selectUser.setNewPwd"}})],1)],1),1==e.selectUser.setNewPwd?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.General_New_Password"),required:"",prop:"password"}},[t("el-input",{attrs:{placeholder:e.$t("m.General_New_Password"),size:"small"},model:{value:e.selectUser.password,callback:function(t){e.$set(e.selectUser,"password",t)},expression:"selectUser.password"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.User_Type")}},[t("el-select",{attrs:{size:"small"},model:{value:e.selectUser.type,callback:function(t){e.$set(e.selectUser,"type",t)},expression:"selectUser.type"}},[t("el-option",{key:1e3,attrs:{label:"超级管理员",value:1e3}}),t("el-option",{key:1008,attrs:{label:"题目管理员",value:1008}}),t("el-option",{key:1001,attrs:{label:"普通管理员",value:1001}}),t("el-option",{key:1002,attrs:{label:"用户(默认)",value:1002}}),t("el-option",{key:1003,attrs:{label:"用户(禁止提交)",value:1003}}),t("el-option",{key:1004,attrs:{label:"用户(禁止发讨论)",value:1004}}),t("el-option",{key:1005,attrs:{label:"用户(禁言)",value:1005}}),t("el-option",{key:1006,attrs:{label:"用户(禁止提交&禁止发讨论)",value:1006}}),t("el-option",{key:1007,attrs:{label:"用户(禁止提交&禁言)",value:1007}}),t("el-option",{key:1009,attrs:{label:"用户(禁止修改个人资料)",value:1009}}),t("el-option",{key:1010,attrs:{label:"用户(禁止修改个人资料&禁言)",value:1010}})],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Title_Name")}},[t("el-input",{attrs:{size:"small"},model:{value:e.selectUser.titleName,callback:function(t){e.$set(e.selectUser,"titleName",t)},expression:"selectUser.titleName"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Title_Color")}},[t("el-color-picker",{model:{value:e.selectUser.titleColor,callback:function(t){e.$set(e.selectUser,"titleColor",t)},expression:"selectUser.titleColor"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Status")}},[t("el-switch",{attrs:{"active-value":0,"inactive-value":1,"active-text":e.$t("m.Normal"),"inactive-text":e.$t("m.Disable")},model:{value:e.selectUser.status,callback:function(t){e.$set(e.selectUser,"status",t)},expression:"selectUser.status"}})],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){e.showUserDialog=!1}}},[e._v(e._s(e.$t("m.Cancel")))]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.saveUser.apply(null,arguments)}}},[e._v(e._s(e.$t("m.OK")))])],1)],1),t("el-dialog",{attrs:{title:e.$t("m.Add_Single_User"),visible:e.showAddUserDialog,width:"400px"},on:{"update:visible":function(t){e.showAddUserDialog=t}}},[t("el-form",{ref:"addUserForm",attrs:{model:e.addUserForm,"label-width":"100px","label-position":"left",rules:e.addUserRules}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Username"),required:"",prop:"username"}},[t("el-input",{attrs:{size:"small"},model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Password"),required:"",prop:"password"}},[t("el-input",{attrs:{type:"password",size:"small",placeholder:e.$t("m.Please_input_password")},model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.RealName"),prop:"realname"}},[t("el-input",{attrs:{size:"small"},model:{value:e.addUserForm.realname,callback:function(t){e.$set(e.addUserForm,"realname",t)},expression:"addUserForm.realname"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Email"),prop:"email"}},[t("el-input",{attrs:{size:"small"},model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.User_Type")}},[t("el-select",{attrs:{size:"small"},model:{value:e.addUserForm.type,callback:function(t){e.$set(e.addUserForm,"type",t)},expression:"addUserForm.type"}},[t("el-option",{key:1e3,attrs:{label:"超级管理员",value:1e3}}),t("el-option",{key:1008,attrs:{label:"题目管理员",value:1008}}),t("el-option",{key:1001,attrs:{label:"普通管理员",value:1001}}),t("el-option",{key:1002,attrs:{label:"用户(默认)",value:1002}}),t("el-option",{key:1003,attrs:{label:"用户(禁止提交)",value:1003}}),t("el-option",{key:1004,attrs:{label:"用户(禁止发讨论)",value:1004}}),t("el-option",{key:1005,attrs:{label:"用户(禁言)",value:1005}}),t("el-option",{key:1006,attrs:{label:"用户(禁止提交&禁止发讨论)",value:1006}}),t("el-option",{key:1007,attrs:{label:"用户(禁止提交&禁言)",value:1007}}),t("el-option",{key:1009,attrs:{label:"用户(禁止修改个人资料)",value:1009}}),t("el-option",{key:1010,attrs:{label:"用户(禁止修改个人资料&禁言)",value:1010}})],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Title_Name")}},[t("el-input",{attrs:{size:"small"},model:{value:e.addUserForm.titleName,callback:function(t){e.$set(e.addUserForm,"titleName",t)},expression:"addUserForm.titleName"}})],1),t("el-form-item",{attrs:{label:e.$t("m.Title_Color")}},[t("el-color-picker",{model:{value:e.addUserForm.titleColor,callback:function(t){e.$set(e.addUserForm,"titleColor",t)},expression:"addUserForm.titleColor"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("m.Status")}},[t("el-switch",{attrs:{"active-value":0,"inactive-value":1,"active-text":e.$t("m.Normal"),"inactive-text":e.$t("m.Disable")},model:{value:e.addUserForm.status,callback:function(t){e.$set(e.addUserForm,"status",t)},expression:"addUserForm.status"}})],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){e.showAddUserDialog=!1}}},[e._v(e._s(e.$t("m.Cancel")))]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.saveAddUser.apply(null,arguments)}}},[e._v(e._s(e.$t("m.OK")))])],1)],1)],1)},i=[],a=(s(52093),s(17932),s(86204),s(76429),s(96466),s(69277)),n=s.n(a),o=s(27328),l=s(15637),u=s(199),d=s(74322),c={name:"user",components:{SecurityConfirm:d.A},data(){const e=(e,t,s)=>{t<this.formGenerateUser.number_from&&s(new Error(this.$i18n.t("m.The_end_number_cannot_be_less_than_the_start_number"))),s()},t=(e,t,s)=>{(t<6||t>25)&&s(new Error(this.$i18n.t("m.Please_select_6_to_25_characters_for_password_length"))),s()},s=(e,t,s)=>{o.A.checkUsernameOrEmail(t,void 0).then(e=>{!0===e.data.data.username&&t!=this.selectUser.username?s(new Error(this.$i18n.t("m.The_username_already_exists"))):s()},e=>s())},r=(e,t,s)=>{o.A.checkUsernameOrEmail(void 0,t).then(e=>{!0===e.data.data.email&&t!=this.selectUser.email?s(new Error(this.$i18n.t("m.The_email_already_exists"))):s()},e=>s())},i=(e,t,s)=>{o.A.checkUsernameOrEmail(t,void 0).then(e=>{!0===e.data.data.username?s(new Error(this.$i18n.t("m.The_username_already_exists"))):s()},e=>s())},a=(e,t,s)=>{o.A.checkUsernameOrEmail(void 0,t).then(e=>{!0===e.data.data.email?s(new Error(this.$i18n.t("m.The_email_already_exists"))):s()},e=>s())};return{pageSize:10,total:0,userList:[],uploadUsers:[],uploadUsersPage:[],uploadUsersCurrentPage:1,uploadUsersPageSize:15,keyword:"",showUserDialog:!1,showAddUserDialog:!1,onlyAdmin:!1,selectUser:{uid:"",username:"",realname:"",email:"",password:"",type:1002,status:0,setNewPwd:!1,titleName:"",titleColor:""},addUserForm:{username:"",password:"",realname:"",email:"",type:1002,status:0,titleName:"",titleColor:""},updateUserRules:{username:[{required:!0,message:"Username is required",trigger:"blur"},{validator:s,trigger:"blur",message:this.$i18n.t("m.The_username_already_exists")},{max:255,message:this.$i18n.t("m.Username_Check_Max"),trigger:"blur"}],realname:[{max:255,trigger:"blur"}],email:[{type:"email",message:this.$i18n.t("m.Email_Check_Format"),trigger:"blur"},{validator:r,message:this.$i18n.t("m.The_email_already_exists"),trigger:"blur"}]},addUserRules:{username:[{required:!0,message:this.$i18n.t("m.Username_Required"),trigger:"blur"},{validator:i,trigger:"blur",message:this.$i18n.t("m.The_username_already_exists")},{max:255,message:this.$i18n.t("m.Username_Check_Max"),trigger:"blur"}],password:[{required:!0,message:this.$i18n.t("m.Password_Required"),trigger:"blur"},{min:6,max:25,message:this.$i18n.t("m.Password_Check_Length"),trigger:"blur"}],realname:[{max:255,trigger:"blur"}],email:[{type:"email",message:this.$i18n.t("m.Email_Check_Format"),trigger:"blur"},{validator:a,message:this.$i18n.t("m.The_email_already_exists"),trigger:"blur"}]},loadingTable:!1,loadingGenerate:!1,currentPage:1,selectedUsers:[],formGenerateUser:{prefix:"",suffix:"",number_from:0,number_to:10,password_length:6},formGenerateRules:{number_from:[{required:!0,message:this.$i18n.t("m.Start_Number_Required"),trigger:"blur"}],number_to:[{required:!0,message:this.$i18n.t("m.End_Number_Required"),trigger:"blur"},{validator:e,trigger:"blur"}],password_length:[{required:!0,message:this.$i18n.t("m.Password_Check_Required"),trigger:"blur"},{type:"number",message:this.$i18n.t("m.Password_Length_Checked"),trigger:"blur"},{validator:t,trigger:"blur"}]},securityConfirmVisible:!1,securityOperationDescription:"",securityOperationType:"",securityOperationData:{},pendingOperation:null}},mounted(){this.getUserList(1)},methods:{currentChange(e){this.currentPage=e,this.getUserList(e)},onPageSizeChange(e){this.pageSize=e,this.getUserList(this.currentPage)},saveUser(){this.$refs["updateUser"].validate(e=>{if(e){const e=this.userList.find(e=>e.uid===this.selectUser.uid),t=e?this.getRole(e.roles):null,s=e?e.status:null;let r=!1,i="",a="";if(t&&t!==this.selectUser.type&&(r=!0,i="user_permission_change",a=`更改用户 ${this.selectUser.username} 的权限从 ${this.getRoleName(t)} 到 ${this.getRoleName(this.selectUser.type)}`),null!==s&&s!==this.selectUser.status)if(r){const e=0===s?"解除封禁":"封禁";a+=`，并${e}用户`,i="user_multiple_changes"}else{r=!0,i="user_status_change";const e=0===s?"封禁":"解除封禁";a=`${e}用户 ${this.selectUser.username}`}this.selectUser.setNewPwd&&this.selectUser.password&&(r?(a+="，并更改密码",i="user_multiple_changes"):(r=!0,i="user_password_change",a=`更改用户 ${this.selectUser.username} 的密码`)),r?this.showSecurityConfirm(i,a,{user:this.selectUser,originalType:t,originalStatus:s}):this.performUserUpdate()}})},filterByKeyword(){this.currentChange(1)},filterByAdmin(){this.currentChange(1)},getRole(e){return e[0]["id"]},openUserDialog(e){this.showUserDialog=!0,this.selectUser.uid=e.uid,this.selectUser.username=e.username,this.selectUser.realname=e.realname,this.selectUser.email=e.email,this.selectUser.setNewPwd=!1,this.selectUser.password="",this.selectUser.type=this.getRole(e.roles),this.selectUser.status=e.status,this.selectUser.titleName=e.titleName,this.selectUser.titleColor=e.titleColor},openAddUserDialog(){console.log("openAddUserDialog 方法被调用"),this.showAddUserDialog=!0,this.resetAddUserForm(),console.log("showAddUserDialog:",this.showAddUserDialog)},resetAddUserForm(){this.addUserForm={username:"",password:"",realname:"",email:"",type:1002,status:0,titleName:"",titleColor:""},this.$refs["addUserForm"]&&this.$refs["addUserForm"].clearValidate()},saveAddUser(){this.$refs["addUserForm"].validate(e=>{e&&this.showSecurityConfirm("add_user",`添加新用户: ${this.addUserForm.username}`,{userForm:this.addUserForm})})},getUserList(e){this.loadingTable=!0,o.A.admin_getUserList(e,this.pageSize,this.keyword,this.onlyAdmin).then(e=>{this.loadingTable=!1,this.total=e.data.data.total,this.userList=e.data.data.records},e=>{this.loadingTable=!1})},deleteUsers(e){if(e||(e=this.selectedUsers),e.length>0){const t=e.map(e=>{const t=this.userList.find(t=>t.uid===e);return t?t.username:`ID:${e}`}).join(", ");this.showSecurityConfirm("delete_users",`删除用户: ${t}`,{userIds:e,usernames:t})}else u.A.warning(this.$i18n.t("m.The_number_of_users_selected_cannot_be_empty"))},checCheckboxkMethod({row:e}){return e.uid!=this.userInfo.uid},handleSelectionChange({records:e}){this.selectedUsers=[];for(let t=0;t<e.length;t++)this.selectedUsers.push(e[t].uid)},handlechangeAll(){let e=this.$refs.xTable.getCheckboxRecords();this.selectedUsers=[];for(let t=0;t<e.length;t++)this.selectedUsers.push(e[t].uid)},generateUser(){this.$refs["formGenerateUser"].validate(e=>{if(!e)return void u.A.error(this.$i18n.t("m.Error_Please_check_your_choice"));this.loadingGenerate=!0;let t=Object.assign({},this.formGenerateUser);o.A.admin_generateUser(t).then(e=>{this.loadingGenerate=!1;let t="/api/file/generate-user-excel?key="+e.data.data.key;l.A.downloadFile(t).then(()=>{this.$alert(this.$i18n.t("m.Generate_User_Success"),"Tips")}),this.getUserList(1)}).catch(()=>{this.loadingGenerate=!1})})},handleUsersCSV(e){n().parse(e,{complete:e=>{let t=e.data.filter(e=>e[0]&&e[1]),s=e.data.length-t.length;s>0&&u.A.warning(s+this.$i18n.t("m.Generate_Skipped_Reason")),this.uploadUsersCurrentPage=1,this.uploadUsers=t,this.uploadUsersPage=t.slice(0,this.uploadUsersPageSize)},error:e=>{u.A.error(e)}})},handleUsersUpload(){o.A.admin_importUsers(this.uploadUsers).then(e=>{this.getUserList(1),this.handleResetData(),u.A.success(this.$i18n.t("m.Upload_Users_Successfully"))}).catch(()=>{})},handleResetData(){this.uploadUsers=[]},showSecurityConfirm(e,t,s){this.securityOperationType=e,this.securityOperationDescription=t,this.securityOperationData=s,this.securityConfirmVisible=!0},handleSecurityConfirm(e){switch(this.securityConfirmVisible=!1,e.operationType){case"user_permission_change":case"user_status_change":case"user_password_change":case"user_multiple_changes":this.performUserUpdate();break;case"delete_users":this.performUserDelete(e.operationData.userIds);break;case"add_user":this.performAddUser(e.operationData.userForm);break;case"reject_real_name":this.performRejectRealName(e.operationData.user);break;default:console.warn("Unknown security operation type:",e.operationType)}},handleSecurityCancel(){this.securityConfirmVisible=!1,this.securityOperationType="",this.securityOperationDescription="",this.securityOperationData={}},performUserUpdate(){o.A.admin_editUser(this.selectUser).then(e=>{u.A.success(this.$i18n.t("m.Update_Successfully")),this.getUserList(this.currentPage)}).then(()=>{this.showUserDialog=!1}).catch(()=>{})},performUserDelete(e){o.A.admin_deleteUsers(e).then(e=>{u.A.success(this.$i18n.$t("m.Delete_successfully")),this.selectedUsers=[],this.getUserList(this.currentPage)}).catch(()=>{this.selectedUsers=[],this.getUserList(this.currentPage)})},performAddUser(e){const t=[e.username,e.password,e.email||"",e.realname||"","","",""];o.A.admin_importUsers([t]).then(e=>{u.A.success(this.$i18n.t("m.Add_User_Successfully")),this.showAddUserDialog=!1,this.getUserList(this.currentPage)}).catch(e=>{console.error("添加用户失败:",e),e.response&&e.response.data?u.A.error(e.response.data.msg||this.$i18n.t("m.Add_User_Failed")):u.A.error(this.$i18n.t("m.Add_User_Failed"))})},rejectRealName(e){this.showSecurityConfirm("reject_real_name",`打回用户 ${e.username} 的实名认证，要求重新填写真实姓名`,{user:e})},performRejectRealName(e){const t={uid:e.uid,username:e.username,realname:"",email:e.email||"",type:e.type||1002,status:e.status||0};console.log("打回实名数据:",t),o.A.admin_editUser(t).then(e=>{console.log("打回实名成功:",e),u.A.success(this.$i18n.t("m.Reject_Real_Name_Success")),this.getUserList(this.currentPage)}).catch(s=>{console.error("打回实名失败:",s),console.error("错误详情:",s.response?.data),console.error("请求数据:",t),this.tryAlternativeRejectMethod(e)})},tryAlternativeRejectMethod(e){console.log("尝试备用打回实名方法");const t={uid:e.uid,realname:""};o.A.admin_editUser(t).then(e=>{console.log("备用方法成功:",e),u.A.success(this.$i18n.t("m.Reject_Real_Name_Success")),this.getUserList(this.currentPage)}).catch(t=>{console.error("备用方法也失败:",t),console.error("备用方法错误详情:",t.response?.data),this.tryUserInfoUpdateMethod(e)})},tryUserInfoUpdateMethod(e){console.log("尝试使用用户信息更新接口");const t={uid:e.uid,realname:""};o.A.changeUserInfo(t).then(e=>{console.log("用户信息更新成功:",e),u.A.success(this.$i18n.t("m.Reject_Real_Name_Success")),this.getUserList(this.currentPage)}).catch(e=>{console.error("用户信息更新也失败:",e),console.error("用户信息更新错误详情:",e.response?.data);const t=e.response?.data?.message||e.message||"未知错误";u.A.error(`打回实名失败: ${t}`)})},getRoleName(e){const t={1e3:"超级管理员",1001:"普通管理员",1002:"用户(默认)",1003:"用户(禁止提交)",1004:"用户(禁止发讨论)",1005:"用户(禁言)",1006:"用户(禁止提交&禁止发讨论)",1007:"用户(禁止提交&禁言)",1008:"题目管理员",1009:"用户(禁止修改个人资料)",1010:"用户(禁止修改个人资料&禁言)"};return t[e]||"未知角色"}},computed:{selectedUserIDs(){let e=[];for(let t of this.selectedUsers)e.push(t.id);return e},userInfo(){return this.$store.getters.userInfo}},watch:{uploadUsersCurrentPage(e){this.uploadUsersPage=this.uploadUsers.slice((e-1)*this.uploadUsersPageSize,e*this.uploadUsersPageSize)}}},h=c,m=s(37419),p=(0,m.A)(h,r,i,!1,null,"30a66526",null),f=p.exports},69277:function(e,t){var s,r,i;
/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/((a,n)=>{r=[],s=n,i="function"===typeof s?s.apply(t,r):s,void 0===i||(e.exports=i)})(0,function e(){var t,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s?s:{},r=!s.document&&!!s.postMessage,i=s.IS_PAPA_WORKER||!1,a={},n=0,o={};function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new m(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let t=this._config.newline;t||(a=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,a)),e=[...e.split(t).slice(r)].join(t)}this.isFirstChunk&&v(this._config.beforeFirstChunk)&&void 0!==(a=this._config.beforeFirstChunk(e))&&(e=a),this.isFirstChunk=!1,this._halted=!1;r=this._partialLine+e;var a=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=a.meta.cursor,this._finished||(this._partialLine=r.substring(e-this._baseIndex),this._baseIndex=e),a&&a.data&&(this._rowCount+=a.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,i)s.postMessage({results:a,workerId:o.WORKER_ID,finished:r});else if(v(this._config.chunk)&&!t){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=a=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),this._completed||!r||!v(this._config.complete)||a&&a.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||a&&a.meta.paused||this._nextChunk(),a}this._halted=!0},this._sendError=function(e){v(this._config.error)?this._config.error(e):i&&this._config.error&&s.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),l.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=U(this._chunkLoaded,this),t.onerror=U(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e,s=this._config.downloadRequestHeaders;for(e in s)t.setRequestHeader(e,s[e])}var i;this._config.chunkSize&&(i=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+i));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function d(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),l.call(this,e);var t,s,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,s=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=U(this._chunkLoaded,this),t.onerror=U(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,i=(this._config.chunkSize&&(i=Math.min(this._start+this._config.chunkSize,this._input.size),e=s.call(e,this._start,i)),t.readAsText(e,this._config.encoding));r||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function c(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,s;if(!this._finished)return e=this._config.chunkSize,t=e?(s=t.substring(0,e),t.substring(e)):(s=t,""),this._finished=!t,this.parseChunk(s)}}function h(e){l.call(this,e=e||{});var t=[],s=!0,r=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):s=!0},this._streamData=U(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=U(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=U(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=U(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(e){var t,s,r,i,a=Math.pow(2,53),n=-a,l=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,u=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,d=this,c=0,h=0,m=!1,_=!1,g=[],y={data:[],errors:[],meta:{}};function U(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function w(){if(y&&r&&(C("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(y.data=y.data.filter(function(e){return!U(e)})),k()){if(y)if(Array.isArray(y.data[0])){for(var t=0;k()&&t<y.data.length;t++)y.data[t].forEach(s);y.data.splice(0,1)}else y.data.forEach(s);function s(t,s){v(e.transformHeader)&&(t=e.transformHeader(t,s)),g.push(t)}}function i(t,s){for(var r=e.header?{}:[],i=0;i<t.length;i++){var o=i,d=t[i];d=((t,s)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===s||"TRUE"===s||"false"!==s&&"FALSE"!==s&&((e=>{if(l.test(e)&&(e=parseFloat(e),n<e&&e<a))return 1})(s)?parseFloat(s):u.test(s)?new Date(s):""===s?null:s):s)(o=e.header?i>=g.length?"__parsed_extra":g[i]:o,d=e.transform?e.transform(d,o):d);"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(d)):r[o]=d}return e.header&&(i>g.length?C("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+i,h+s):i<g.length&&C("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+i,h+s)),r}var d;y&&(e.header||e.dynamicTyping||e.transform)&&(d=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(i),d=y.data.length):y.data=i(y.data,0),e.header&&y.meta&&(y.meta.fields=g),h+=d)}function k(){return e.header&&0===g.length}function C(e,t,s,r){e={type:e,code:t,message:s},void 0!==r&&(e.row=r),y.errors.push(e)}v(e.step)&&(i=e.step,e.step=function(t){y=t,k()?w():(w(),0!==y.data.length&&(c+=t.data.length,e.preview&&c>e.preview?s.abort():(y.data=y.data[0],i(y,d))))}),this.parse=function(i,a,n){var l=e.quoteChar||'"';e.newline||(e.newline=this.guessLineEndings(i,l)),r=!1,e.delimiter?v(e.delimiter)&&(e.delimiter=e.delimiter(i),y.meta.delimiter=e.delimiter):((l=((t,s,r,i,a)=>{var n,l,u,d;a=a||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var c=0;c<a.length;c++){for(var h,m=a[c],p=0,_=0,g=0,y=(u=void 0,new f({comments:i,delimiter:m,newline:s,preview:10}).parse(t)),b=0;b<y.data.length;b++)r&&U(y.data[b])?g++:(h=y.data[b].length,_+=h,void 0===u?u=h:0<h&&(p+=Math.abs(h-u),u=h));0<y.data.length&&(_/=y.data.length-g),(void 0===l||p<=l)&&(void 0===d||d<_)&&1.99<_&&(l=p,n=m,d=_)}return{successful:!!(e.delimiter=n),bestDelimiter:n}})(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=l.bestDelimiter:(r=!0,e.delimiter=o.DefaultDelimiter),y.meta.delimiter=e.delimiter),l=b(e);return e.preview&&e.header&&l.preview++,t=i,s=new f(l),y=s.parse(t,a,n),w(),m?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return m},this.pause=function(){m=!0,s.abort(),t=v(e.chunk)?"":t.substring(s.getCharIndex())},this.resume=function(){d.streamer._halted?(m=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return _},this.abort=function(){_=!0,s.abort(),y.meta.aborted=!0,v(e.complete)&&e.complete(y),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576);t=new RegExp(p(t)+"([^]*?)"+p(t),"gm");var s=(e=e.replace(t,"")).split("\r");t=e.split("\n"),e=1<t.length&&t[0].length<s[0].length;if(1===s.length||e)return"\n";for(var r=0,i=0;i<s.length;i++)"\n"===s[i][0]&&r++;return r>=s.length/2?"\r\n":"\r"}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(e){var t=(e=e||{}).delimiter,s=e.newline,r=e.comments,i=e.step,a=e.preview,n=e.fastMode,l=null,u=!1,d=null==e.quoteChar?'"':e.quoteChar,c=d;if(void 0!==e.escapeChar&&(c=e.escapeChar),("string"!=typeof t||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),r===t)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<o.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==s&&"\r"!==s&&"\r\n"!==s&&(s="\n");var h=0,m=!1;this.parse=function(o,f,_){if("string"!=typeof o)throw new Error("Input must be a string");var g=o.length,y=t.length,b=s.length,U=r.length,w=v(i),k=[],C=[],$=[],x=h=0;if(!o)return L();if(n||!1!==n&&-1===o.indexOf(d)){for(var S=o.split(s),A=0;A<S.length;A++){if($=S[A],h+=$.length,A!==S.length-1)h+=s.length;else if(_)return L();if(!r||$.substring(0,U)!==r){if(w){if(k=[],P($.split(t)),N(),m)return L()}else P($.split(t));if(a&&a<=A)return k=k.slice(0,a),L(!0)}}return L()}for(var R=o.indexOf(t,h),E=o.indexOf(s,h),O=new RegExp(p(c)+p(d),"g"),D=o.indexOf(d,h);;)if(o[h]===d)for(D=h,h++;;){if(-1===(D=o.indexOf(d,D+1)))return _||C.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:h}),I();if(D===g-1)return I(o.substring(h,D).replace(O,d));if(d===c&&o[D+1]===c)D++;else if(d===c||0===D||o[D-1]!==c){-1!==R&&R<D+1&&(R=o.indexOf(t,D+1));var T=F(-1===(E=-1!==E&&E<D+1?o.indexOf(s,D+1):E)?R:Math.min(R,E));if(o.substr(D+1+T,y)===t){$.push(o.substring(h,D).replace(O,d)),o[h=D+1+T+y]!==d&&(D=o.indexOf(d,h)),R=o.indexOf(t,h),E=o.indexOf(s,h);break}if(T=F(E),o.substring(D+1+T,D+1+T+b)===s){if($.push(o.substring(h,D).replace(O,d)),z(D+1+T+b),R=o.indexOf(t,h),D=o.indexOf(d,h),w&&(N(),m))return L();if(a&&k.length>=a)return L(!0);break}C.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:h}),D++}}else if(r&&0===$.length&&o.substring(h,h+U)===r){if(-1===E)return L();h=E+b,E=o.indexOf(s,h),R=o.indexOf(t,h)}else if(-1!==R&&(R<E||-1===E))$.push(o.substring(h,R)),h=R+y,R=o.indexOf(t,h);else{if(-1===E)break;if($.push(o.substring(h,E)),z(E+b),w&&(N(),m))return L();if(a&&k.length>=a)return L(!0)}return I();function P(e){k.push(e),x=h}function F(e){var t=0;return-1!==e&&(e=o.substring(D+1,e))&&""===e.trim()?e.length:t}function I(e){return _||(void 0===e&&(e=o.substring(h)),$.push(e),h=g,P($),w&&N()),L()}function z(e){h=e,P($),$=[],E=o.indexOf(s,h)}function L(r){if(e.header&&!f&&k.length&&!u){var i=k[0],a=Object.create(null),n=new Set(i);let t=!1;for(let s=0;s<i.length;s++){let r=i[s];if(a[r=v(e.transformHeader)?e.transformHeader(r,s):r]){let e,o=a[r];for(;e=r+"_"+o,o++,n.has(e););n.add(e),i[s]=e,a[r]++,t=!0,(l=null===l?{}:l)[e]=r}else a[r]=1,i[s]=r;n.add(r)}t&&console.warn("Duplicate headers found and renamed."),u=!0}return{data:k,errors:C,meta:{delimiter:t,linebreak:s,aborted:m,truncated:!!r,cursor:x+(f||0),renamedHeaders:l}}}function N(){i(L()),k=[],C=[]}},this.abort=function(){m=!0},this.getCharIndex=function(){return h}}function _(e){var t=e.data,s=a[t.workerId],r=!1;if(t.error)s.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){r=!0,g(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(v(s.userStep)){for(var n=0;n<t.results.data.length&&(s.userStep({data:t.results.data[n],errors:t.results.errors,meta:t.results.meta},i),!r);n++);delete t.results}else v(s.userChunk)&&(s.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!r&&g(t.workerId,t.results)}function g(e,t){var s=a[e];v(s.userComplete)&&s.userComplete(t),s.terminate(),delete a[e]}function y(){throw new Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t,s=Array.isArray(e)?[]:{};for(t in e)s[t]=b(e[t]);return s}function U(e,t){return function(){e.apply(t,arguments)}}function v(e){return"function"==typeof e}return o.parse=function(t,r){var i=(r=r||{}).dynamicTyping||!1;if(v(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!v(r.transform)&&r.transform,!r.worker||!o.WORKERS_SUPPORTED)return i=null,o.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),i=new(r.download?u:c)(r)):!0===t.readable&&v(t.read)&&v(t.on)?i=new h(r):(s.File&&t instanceof File||t instanceof Object)&&(i=new d(r)),i.stream(t);(i=(()=>{var t;return!!o.WORKERS_SUPPORTED&&(t=(()=>{var t=s.URL||s.webkitURL||null,r=e.toString();return o.BLOB_URL||(o.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(t=new s.Worker(t)).onmessage=_,t.id=n++,a[t.id]=t)})()).userStep=r.step,i.userChunk=r.chunk,i.userComplete=r.complete,i.userError=r.error,r.step=v(r.step),r.chunk=v(r.chunk),r.complete=v(r.complete),r.error=v(r.error),delete r.worker,i.postMessage({input:t,config:r,workerId:i.id})},o.unparse=function(e,t){var s=!1,r=!0,i=",",a="\r\n",n='"',l=n+n,u=!1,d=null,c=!1,h=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(i=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(s=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(a=t.newline),"string"==typeof t.quoteChar&&(n=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");d=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+n),t.escapeFormulae instanceof RegExp?c=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(c=/^[=+\-@\t\r].*$/)}})(),new RegExp(p(n),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return m(null,e,u);if("object"==typeof e[0])return m(d||Object.keys(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),m(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function m(e,t,s){var n="",o=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),l=!Array.isArray(t[0]);if(o&&r){for(var u=0;u<e.length;u++)0<u&&(n+=i),n+=f(e[u],u);0<t.length&&(n+=a)}for(var d=0;d<t.length;d++){var c=(o?e:t[d]).length,h=!1,m=o?0===Object.keys(t[d]).length:0===t[d].length;if(s&&!o&&(h="greedy"===s?""===t[d].join("").trim():1===t[d].length&&0===t[d][0].length),"greedy"===s&&o){for(var p=[],_=0;_<c;_++){var g=l?e[_]:_;p.push(t[d][g])}h=""===p.join("").trim()}if(!h){for(var y=0;y<c;y++){0<y&&!m&&(n+=i);var b=o&&l?e[y]:y;n+=f(t[d][b],y)}d<t.length-1&&(!s||0<c&&!m)&&(n+=a)}}return n}function f(e,t){var r,a;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(a=!1,c&&"string"==typeof e&&c.test(e)&&(e="'"+e,a=!0),r=e.toString().replace(h,l),(a=a||!0===s||"function"==typeof s&&s(e,t)||Array.isArray(s)&&s[t]||((e,t)=>{for(var s=0;s<t.length;s++)if(-1<e.indexOf(t[s]))return!0;return!1})(r,o.BAD_DELIMITERS)||-1<r.indexOf(i)||" "===r.charAt(0)||" "===r.charAt(r.length-1))?n+r+n:r)}},o.RECORD_SEP=String.fromCharCode(30),o.UNIT_SEP=String.fromCharCode(31),o.BYTE_ORDER_MARK="\ufeff",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!r&&!!s.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=f,o.ParserHandle=m,o.NetworkStreamer=u,o.FileStreamer=d,o.StringStreamer=c,o.ReadableStreamStreamer=h,s.jQuery&&((t=s.jQuery).fn.parse=function(e){var r=e.config||{},i=[];return this.each(function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!s.FileReader||!this.files||0===this.files.length)return!0;for(var a=0;a<this.files.length;a++)i.push({file:this.files[a],inputElem:this,instanceConfig:t.extend({},r)})}),a(),this;function a(){if(0===i.length)v(e.complete)&&e.complete();else{var s,r,a,l,u=i[0];if(v(e.before)){var d=e.before(u.file,u.inputElem);if("object"==typeof d){if("abort"===d.action)return s="AbortError",r=u.file,a=u.inputElem,l=d.reason,void(v(e.error)&&e.error({name:s},r,a,l));if("skip"===d.action)return void n();"object"==typeof d.config&&(u.instanceConfig=t.extend(u.instanceConfig,d.config))}else if("skip"===d)return void n()}var c=u.instanceConfig.complete;u.instanceConfig.complete=function(e){v(c)&&c(e,u.file,u.inputElem),n()},o.parse(u.file,u.instanceConfig)}}function n(){i.splice(0,1),a()}}),i&&(s.onmessage=function(e){e=e.data,void 0===o.WORKER_ID&&e&&(o.WORKER_ID=e.workerId),"string"==typeof e.input?s.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0}):(s.File&&e.input instanceof File||e.input instanceof Object)&&(e=o.parse(e.input,e.config))&&s.postMessage({workerId:o.WORKER_ID,results:e,finished:!0})}),(u.prototype=Object.create(l.prototype)).constructor=u,(d.prototype=Object.create(l.prototype)).constructor=d,(c.prototype=Object.create(c.prototype)).constructor=c,(h.prototype=Object.create(l.prototype)).constructor=h,o})},74322:function(e,t,s){"use strict";s.d(t,{A:function(){return d}});var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.$t("m.Security_Confirm"),visible:e.visible,width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"security-confirm-content"},[t("div",{staticClass:"warning-icon"},[t("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"48px"}})]),t("div",{staticClass:"warning-text"},[t("h3",[e._v(e._s(e.$t("m.Security_Operation_Warning")))]),t("p",[e._v(e._s(e.operationDescription))])]),t("div",{staticClass:"password-input"},[t("el-input",{attrs:{type:"password",placeholder:e.$t("m.Enter_Security_Password"),"show-password":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleConfirm.apply(null,arguments)}},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}})],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCancel}},[e._v(e._s(e.$t("m.Cancel")))]),t("el-button",{attrs:{type:"danger",loading:e.loading,disabled:!e.confirmPassword},on:{click:e.handleConfirm}},[e._v(" "+e._s(e.$t("m.Confirm"))+" ")])],1)])},i=[],a=s(27328),n={name:"SecurityConfirm",props:{visible:{type:Boolean,default:!1},operationDescription:{type:String,default:""},operationType:{type:String,default:""},operationData:{type:Object,default:()=>({})}},data(){return{confirmPassword:"",loading:!1,SECURITY_PASSWORD:"fdtfdt"}},methods:{async handleConfirm(){if(this.confirmPassword){if(this.confirmPassword!==this.SECURITY_PASSWORD)return this.$message.error(this.$i18n.t("m.Incorrect_Security_Password")),void(this.confirmPassword="");this.loading=!0;try{const e=await this.getMacAddress();await this.logSecurityOperation(e),this.$emit("confirm",{operationType:this.operationType,operationData:this.operationData,macAddress:e}),this.handleCancel(),this.$message.success(this.$i18n.t("m.Security_Operation_Confirmed"))}catch(e){console.error("Security operation failed:",e),this.$message.error(this.$i18n.t("m.Security_Operation_Failed"))}finally{this.loading=!1}}else this.$message.error(this.$i18n.t("m.Please_Enter_Password"))},handleCancel(){this.confirmPassword="",this.$emit("cancel")},async getMacAddress(){try{const e=await fetch("/api/get-mac-address");if(e.ok){const t=await e.json();return t.macAddress||"unknown"}}catch(s){console.warn("Failed to get MAC address:",s)}navigator.userAgent;const e=Date.now(),t=Math.random().toString(36).substring(2);return`client_${e}_${t}`},async logSecurityOperation(e){try{const t={operationType:this.operationType,operationData:this.operationData,macAddress:e,userAgent:navigator.userAgent,timestamp:(new Date).toISOString(),userId:this.$store.getters.userInfo.uid,username:this.$store.getters.userInfo.username};await a.A.logSecurityOperation(t)}catch(t){console.error("Failed to log security operation:",t)}}},watch:{visible(e){e&&(this.confirmPassword="")}}},o=n,l=s(37419),u=(0,l.A)(o,r,i,!1,null,"6061a289",null),d=u.exports}}]);