(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c21065d6"],{"1dcd":function(e,a,t){},a507:function(e,a,t){"use strict";t("1dcd")},ea5f:function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e._self._c;return a("div",{staticClass:"real-name-auth-page"},[a("div",{staticClass:"auth-container"},[a("div",{staticClass:"auth-header"},[a("h1",[e._v(e._s(e.$t("m.Real_Name_Authentication")))]),a("p",[e._v(e._s(e.$t("m.Real_Name_Required_Description")))])]),a("el-card",{staticClass:"auth-card"},[a("el-form",{ref:"realNameForm",attrs:{model:e.realNameForm,rules:e.realNameRules,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:e.$t("m.Username"),prop:"username"}},[a("el-input",{attrs:{disabled:""},model:{value:e.realNameForm.username,callback:function(a){e.$set(e.realNameForm,"username",a)},expression:"realNameForm.username"}})],1),a("el-form-item",{attrs:{label:e.$t("真实姓名"),prop:"realname",required:""}},[a("el-input",{attrs:{placeholder:e.$t("m.Please_Enter_Real_Name"),maxlength:"20","show-word-limit":""},model:{value:e.realNameForm.realname,callback:function(a){e.$set(e.realNameForm,"realname",a)},expression:"realNameForm.realname"}})],1),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading,size:"large"},on:{click:e.submitRealName}},[e._v(" "+e._s(e.$t("m.Submit_Real_Name"))+" ")])],1)],1)],1)],1)])},s=[],i=(t("d9e2"),t("14d9"),t("e9f5"),t("7d54"),t("3228")),o=t("7aa9"),n={name:"RealNameAuth",data(){return{loading:!1,realNameForm:{username:"",realname:"",email:"",phone:"",school:"",studentId:""},realNameRules:{realname:[{required:!0,message:this.$i18n.t("m.Real_Name_Required"),trigger:"blur"},{min:2,max:20,message:this.$i18n.t("m.Real_Name_Length_Error"),trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:this.$i18n.t("m.Real_Name_Format_Error"),trigger:"blur"}],email:[{type:"email",message:this.$i18n.t("m.Email_Format_Error"),trigger:"blur"}],phone:[{validator:this.validatePhoneNumber,trigger:"blur"}]},personalAPI:{enabled:!1,baseURL:"http://localhost:8888",endpoint:"/api/real-name-auth"}}},mounted(){this.initForm()},methods:{validatePhoneNumber(e,a,t){if(!a||""===a.trim())return void t();const r=a.replace(/^\+86\s*/,"").replace(/\s/g,""),s=/^1[3-9]\d{9}$/;s.test(r)?(this.realNameForm.phone=r,t()):t(new Error(this.$i18n.t("m.Phone_Format_Error_China")))},initForm(){const e=this.$store.getters.userInfo;e&&(this.realNameForm={username:e.username||"",realname:e.realname||"",email:e.email||"",phone:e.phone||"",school:e.school||"",studentId:e.number||""})},submitRealName(){this.$refs.realNameForm.validate(e=>{if(!e)return;this.loading=!0;const a=this.$store.getters.userInfo,t={...a,realname:this.realNameForm.realname,email:this.realNameForm.email,phone:this.realNameForm.phone,school:this.realNameForm.school,number:this.realNameForm.studentId,gender:a.gender||"secrecy"},r=this.filterEmptyValue(t);this.submitToPersonalAPI(r)})},filterEmptyValue(e){const a={};return Object.keys(e).forEach(t=>{null!==e[t]&&void 0!==e[t]&&""!==e[t]&&(a[t]=e[t])}),a},submitToPersonalAPI(e){if(!this.personalAPI.enabled)return void i["a"].changeUserInfo(e).then(e=>{this.loading=!1,o["a"].success(this.$i18n.t("m.Real_Name_Submit_Success")),this.$store.dispatch("setUserInfo",e.data.data),this.$router.push({name:"ProblemList"})},e=>{this.loading=!1,console.error("实名认证提交失败:",e),e.response&&e.response.data?o["a"].error(e.response.data.msg||this.$i18n.t("m.Real_Name_Submit_Failed")):o["a"].error(this.$i18n.t("m.Real_Name_Submit_Failed"))});const a=t("bc3a"),r=a.create({baseURL:this.personalAPI.baseURL,timeout:1e4});r.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=a),e.headers["Content-Type"]="application/json",e}),r.post(this.personalAPI.endpoint,e).then(e=>{this.loading=!1,o["a"].success(this.$i18n.t("m.Real_Name_Submit_Success")),e.data&&e.data.data&&this.$store.dispatch("setUserInfo",e.data.data),this.$router.push({name:"ProblemList"})}).catch(a=>{this.loading=!1,console.error("个人API实名认证提交失败:",a),"ECONNREFUSED"===a.code||a.message.includes("Network Error")?(console.log("个人API连接失败，自动切换到系统API"),o["a"].warning("个人API连接失败，正在使用系统默认API重试..."),this.submitToSystemAPI(e)):a.response&&a.response.data?o["a"].error(a.response.data.msg||this.$i18n.t("m.Real_Name_Submit_Failed")):o["a"].error(this.$i18n.t("m.Real_Name_Submit_Failed"))})},submitToSystemAPI(e){i["a"].changeUserInfo(e).then(e=>{this.loading=!1,o["a"].success(this.$i18n.t("m.Real_Name_Submit_Success")),this.$store.dispatch("setUserInfo",e.data.data),this.$router.push({name:"ProblemList"})},e=>{this.loading=!1,console.error("系统API实名认证提交失败:",e),e.response&&e.response.data?o["a"].error(e.response.data.msg||this.$i18n.t("m.Real_Name_Submit_Failed")):o["a"].error(this.$i18n.t("m.Real_Name_Submit_Failed"))})}}},l=n,m=(t("a507"),t("2877")),u=Object(m["a"])(l,r,s,!1,null,"625fd349",null);a["default"]=u.exports}}]);